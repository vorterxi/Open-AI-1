/**
 Copyright (C) 2023.
 Licensed under the  GPL-3.0 License;
 You may not use this file except in compliance with the License.
 It is supplied in the hope that it may be useful.
 * @project_name : ·¥è·¥ò·¥á…¥ ·¥Ä‚Å± ‚ôï
 * @author : ùêåùêöùê°ùêûùê´ ùêôùêÆùêõùêöùê¢ùê´ ‚ôï <https://github.com/Mehar-Zubair>
 * @description : ·¥è·¥ò·¥á…¥ ·¥Ä‚Å± ‚ôï,A Multi-functional whatsapp bot.
 * @version 1.0.3 
 **/
const _0x93f633=_0x2184;(function(_0xdcd133,_0x2ba2b4){const _0x2cbd53=_0x2184,_0x19bbcb=_0xdcd133();while(!![]){try{const _0x8d8d0b=parseInt(_0x2cbd53(0x1d4))/0x1*(-parseInt(_0x2cbd53(0x1c5))/0x2)+parseInt(_0x2cbd53(0x1ce))/0x3*(parseInt(_0x2cbd53(0x1bd))/0x4)+parseInt(_0x2cbd53(0x1d6))/0x5*(-parseInt(_0x2cbd53(0x1ca))/0x6)+-parseInt(_0x2cbd53(0x1d7))/0x7+parseInt(_0x2cbd53(0x1d0))/0x8+-parseInt(_0x2cbd53(0x1d8))/0x9*(parseInt(_0x2cbd53(0x1cc))/0xa)+parseInt(_0x2cbd53(0x1c4))/0xb;if(_0x8d8d0b===_0x2ba2b4)break;else _0x19bbcb['push'](_0x19bbcb['shift']());}catch(_0x273f1e){_0x19bbcb['push'](_0x19bbcb['shift']());}}}(_0x16a4,0xaeaa9));const _0x34a4ff=(function(){let _0x4d04d7=!![];return function(_0x47bf96,_0x1296fe){const _0x5302ad=_0x4d04d7?function(){if(_0x1296fe){const _0x58f7e1=_0x1296fe['apply'](_0x47bf96,arguments);return _0x1296fe=null,_0x58f7e1;}}:function(){};return _0x4d04d7=![],_0x5302ad;};}()),_0x9432bf=_0x34a4ff(this,function(){const _0x344bb8=_0x2184;return _0x9432bf['toString']()[_0x344bb8(0x1d2)](_0x344bb8(0x1cd))['toString']()[_0x344bb8(0x1ba)](_0x9432bf)['search'](_0x344bb8(0x1cd));});_0x9432bf();function _0x2184(_0x3e0c98,_0x328cfa){const _0xe81200=_0x16a4();return _0x2184=function(_0x17f1c2,_0x53ac8b){_0x17f1c2=_0x17f1c2-0x1ba;let _0x306237=_0xe81200[_0x17f1c2];return _0x306237;},_0x2184(_0x3e0c98,_0x328cfa);}function _0x16a4(){const _0x2b9aa2=['toString','length','prototype','info','25339754XcGojM','497316BhfyEa','error','trace','exception','console','1572054PPysQt','__proto__','10ZnhWcT','(((.+)+)+)+$','39iwNKSZ','bind','6342776qgeQqf','return\x20(function()\x20','search','warn','2sjQuSK','{}.constructor(\x22return\x20this\x22)(\x20)','25aqfbyf','880572GOdelc','5235588BVOerB','../config','constructor','table','log','41188Hgqiid','axios','apply'];_0x16a4=function(){return _0x2b9aa2;};return _0x16a4();}const _0x53ac8b=(function(){let _0x1d1f85=!![];return function(_0x323ecf,_0xc33b51){const _0x108d63=_0x1d1f85?function(){const _0xeff0a2=_0x2184;if(_0xc33b51){const _0x523d58=_0xc33b51[_0xeff0a2(0x1bf)](_0x323ecf,arguments);return _0xc33b51=null,_0x523d58;}}:function(){};return _0x1d1f85=![],_0x108d63;};}()),_0x17f1c2=_0x53ac8b(this,function(){const _0xacff11=_0x2184,_0x18e790=function(){const _0x541a46=_0x2184;let _0x5dbf5a;try{_0x5dbf5a=Function(_0x541a46(0x1d1)+_0x541a46(0x1d5)+');')();}catch(_0x10e160){_0x5dbf5a=window;}return _0x5dbf5a;},_0x43eb99=_0x18e790(),_0x412d2e=_0x43eb99['console']=_0x43eb99[_0xacff11(0x1c9)]||{},_0x3565e4=[_0xacff11(0x1bc),_0xacff11(0x1d3),_0xacff11(0x1c3),_0xacff11(0x1c6),_0xacff11(0x1c8),_0xacff11(0x1bb),_0xacff11(0x1c7)];for(let _0x2ef3ab=0x0;_0x2ef3ab<_0x3565e4[_0xacff11(0x1c1)];_0x2ef3ab++){const _0x51acdc=_0x53ac8b[_0xacff11(0x1ba)][_0xacff11(0x1c2)]['bind'](_0x53ac8b),_0x2590a5=_0x3565e4[_0x2ef3ab],_0x5adfb7=_0x412d2e[_0x2590a5]||_0x51acdc;_0x51acdc[_0xacff11(0x1cb)]=_0x53ac8b[_0xacff11(0x1cf)](_0x53ac8b),_0x51acdc[_0xacff11(0x1c0)]=_0x5adfb7[_0xacff11(0x1c0)][_0xacff11(0x1cf)](_0x5adfb7),_0x412d2e[_0x2590a5]=_0x51acdc;}});_0x17f1c2();const axios=require(_0x93f633(0x1be)),{tlang,smd}=require('../lib'),Config=require(_0x93f633(0x1d9)),{redeploy,getvar,delvar,getallvar,change_env,get_deployments}=require('../lib/koyeb');


//----------------------------------------------------------------------------------------------------------------------------------------------------
smd(
  {
    pattern: "updatenow",
    alias: ["unow"],
    desc: "update bot with main repo.",
    filename: __filename,
    category: "misc",
  },
  async (Void,citel,text,{isCreator}) => {
    async function updatedb() {	
      const simpleGit = require('simple-git')	
          const git = simpleGit();	
        const Heroku = require('heroku-client');	
        const heroku = new Heroku({ token: process.env.HEROKU_API_KEY })	
          await git.fetch();	
              var commits = await git.log(['main' + '..origin/' +'main']);	
              if (commits.total === 0) {	
                return ' è·¥è·¥ú.. ú·¥Ä·¥†·¥á...·¥Ä ü Ä·¥á·¥Ö è..·¥ú·¥ò·¥Ö·¥Ä·¥õ·¥á·¥Ö...'	
              } else {	
                    var app = await heroku.get('/apps/' + process.env.HEROKU_APP_NAME)	
                   //   await Void.sendMessage(citel.chat,{text:'*·¥ú·¥ò·¥Ö·¥Ä·¥õ…™…¥…¢...*'})	
                  git.fetch('upstream', 'main');	
                  git.reset('hard', ['FETCH_HEAD']);	
      
                  var git_url = app.git_url.replace(	
                    "https://", "https://api:" + process.env.HEROKU_API_KEY + "@"	
                  )   	
                  try {	
                    await git.addRemote('heroku', git_url);	
                  } catch { console.log('heroku remote adding error'); }	
                  await git.push('heroku', 'main');	
      
                  return '* ô·¥è·¥õ ·¥ú·¥ò·¥Ö·¥Ä·¥õ·¥á·¥Ö...*\n Ä·¥ás·¥õ·¥Ä Ä·¥õ…™…¥…¢'	
      
      
              }	
            }	
       if(!isCreator) return citel.reply(tlang().owner);
       if (Config.heroku=true){
        const DB = require('../lib')
        let commits = await DB.syncgit()
        if (commits.total === 0)  {
         citel.reply(` ú·¥á è ${citel.pushName}.  è·¥è·¥ú  ú·¥Ä·¥†·¥á  ü·¥Ä·¥õ·¥ás·¥õ ·¥†·¥á Äs…™·¥è…¥ …™…¥s·¥õ·¥Ä ü ü·¥á·¥Ö.`)
          } else { 
             citel.reply(' ô·¥ú…™ ü·¥Ö s·¥õ·¥Ä Ä·¥õ·¥á·¥Ö...')
            let update = await DB.updatedb()
              citel.reply(update)
          }

       }
       let check = await get_deployments()
       if(check==='true') return citel.reply('·¥ò ü·¥á·¥Äs·¥á ·¥°·¥Ä…™·¥õ...\n·¥Ñ·¥ú Ä Ä·¥á…¥·¥õ ü è 2 …™…¥s·¥õ·¥Ä…¥·¥Ñ·¥ás ·¥Ä Ä·¥á  Ä·¥ú…¥…¥…™…¥…¢ …™…¥ ·¥ã·¥è è·¥á ô,·¥°·¥Ä…™·¥õ ·¥õ·¥è s·¥õ·¥è·¥ò ·¥è…¥·¥á ·¥è“ì ·¥õ ú·¥á·¥ç.')
       let data = await redeploy();
       return citel.reply(data)
  })
//----------------------------------------------------------------------------------------------------------------------------------------------------
smd(
  {
    pattern: "getvar",
    desc: "get desired var from koyeb.",
    filename: __filename,
    category: "misc",
  },
  async (Void,citel,text,{isCreator}) => {
       if(!isCreator) return citel.reply(tlang().owner);
       if (Config.heroku=true){
        if (!text.split(' ')[0]) return citel.reply(`·¥ò ü·¥á·¥Äs·¥á …¢…™·¥†·¥á ·¥ç·¥á ·¥†·¥Ä Ä …¥·¥Ä·¥ç·¥á, ${tlang().greet}`)
        const Heroku = require("heroku-client");
        const heroku = new Heroku({
          token: Config.HEROKU.API_KEY,
        });
        let baseURI = "/apps/" + Config.HEROKU.APP_NAME;
  let h = await heroku.get(baseURI+'/config-vars')
  for (vr in h) {
  if(text.split(' ')[0]===vr) return citel.reply(' è·¥è·¥ú Ä ·¥†·¥Ä Ä.\n'+vr+': '+h[vr])	
  }
       }
       if(!text) return citel.reply('·¥ò ü·¥á·¥Äs·¥á ·¥ò Ä·¥è·¥†…™·¥Ö·¥á ·¥ã·¥á è.\n·¥á…¢: .…¢·¥á·¥õ·¥†·¥Ä Ä ·¥°·¥è Ä·¥ã·¥õ è·¥ò·¥á')
       let data = await getvar(text);
       return citel.reply(data)
  })
//----------------------------------------------------------------------------------------------------------------------------------------------------
smd(
  {
    pattern: "getallvar",
    desc: "get all vars from koyeb.",
    filename: __filename,
    category: "misc",
  },
  async (Void,citel,text,{isCreator}) => {
       if(!isCreator) return citel.reply(tlang().owner);
       if (Config.heroku=true){
        const Heroku = require("heroku-client");
			const heroku = new Heroku({
				token: Config.HEROKU.API_KEY,
			});
			let baseURI = "/apps/" + Config.HEROKU.APP_NAME;
let h = await heroku.get(baseURI+'/config-vars')
let str = '*·¥Ä ü ü  è·¥è·¥ú Ä  ú·¥á Ä·¥è·¥ã·¥ú ·¥†·¥Ä Äs*\n\n'
for (vr in h) {
str+= vr+':'+h[vr]+'\n'
}
citel.reply(str)
       }
       let data = await getallvar();
       return citel.reply(data)
  })
//----------------------------------------------------------------------------------------------------------------------------------------------------
smd(
  {
    pattern: "setvar",
    desc: "set var in koyeb.",
    filename: __filename,
    category: "misc",
  },
  async (Void,citel,text,{isCreator}) => {
       if(!isCreator) return citel.reply(tlang().owner);
       if(!text.split(':')[1]) return citel.reply('*·¥° Ä·¥è…¥…¢ “ì·¥è Ä·¥ç·¥Ä·¥õ.*\…¥·¥ò ü·¥á·¥Äs·¥á ·¥ò Ä·¥è·¥†…™·¥Ö·¥á ·¥ã·¥á è ·¥Ä…¥·¥Ö ·¥†·¥Ä ü·¥ú·¥á.\n·¥á…¢: .s·¥á·¥õ·¥†·¥Ä Ä ·¥õ ú·¥á·¥ç·¥á:·¥ç·¥¢')
       if (Config.heroku=true){
        const Heroku = require("heroku-client");
        const heroku = new Heroku({
          token: Config.HEROKU.API_KEY,
        });
        let baseURI = "/apps/" + Config.HEROKU.APP_NAME;
        await heroku.patch(baseURI + "/config-vars", {
          body: {
                  [text.split(':')[0]]: text.split(':')[1],
          },
        });
        await citel.reply(`·¥†·¥Ä Ä ${text.split(':')[0]} : ${text.split(':')[1]}  ú·¥Äs  ô·¥á·¥á…¥ s·¥á·¥õ s·¥ú·¥Ñ·¥Ñ·¥áss“ì·¥ú ü ü è.`);
       }
       let check = await get_deployments()
       if(check==='true') return citel.reply('·¥ò ü·¥á·¥Äs·¥á ·¥°·¥Ä…™·¥õ...\n·¥Ñ·¥ú Ä Ä·¥á…¥·¥õ ü è 2 …™…¥s·¥õ·¥Ä…¥·¥Ñ·¥ás ·¥Ä Ä·¥á  Ä·¥ú…¥…¥…™…¥…¢ …™…¥ ·¥ã·¥è è·¥á ô,·¥°·¥Ä…™·¥õ ·¥õ·¥è s·¥õ·¥è·¥ò ·¥è…¥·¥á ·¥è“ì ·¥õ ú·¥á·¥ç.')
       let data = await change_env(text)
       return citel.reply(data)
  })

//----------------------------------------------------------------------------------------------------------------------------------------------------
smd(
  {
    pattern: "delvar",
    desc: "delete var from koyeb.",
    filename: __filename,
    category: "misc",
  },
  async (Void,citel,text,{isCreator}) => {
       if(!isCreator) return citel.reply(tlang().owner);
       if(!text) return citel.reply('·¥ò ü·¥á·¥Äs·¥á ·¥ò Ä·¥è·¥†…™·¥Ö·¥á ·¥ã·¥á è\n·¥á…¢: .·¥Ö·¥á ü·¥†·¥Ä Ä ·¥ò·¥è Ä·¥õ')
       let check = await get_deployments()
       if(check==='true') return citel.reply('·¥ò ü·¥á·¥Äs·¥á ·¥°·¥Ä…™·¥õ...\n·¥Ñ·¥ú Ä Ä·¥á…¥·¥õ ü è 2 …™…¥s·¥õ·¥Ä…¥·¥Ñ·¥ás ·¥Ä Ä·¥á  Ä·¥ú…¥…¥…™…¥…¢ …™…¥ ·¥ã·¥è è·¥á ô,·¥°·¥Ä…™·¥õ ·¥õ·¥è s·¥õ·¥è·¥ò ·¥è…¥·¥á ·¥è“ì ·¥õ ú·¥á·¥ç.')
       let data = await delvar(text)
       return citel.reply(data)
  })
//-------------------------------------------------------------------------------------------------------------------------------

